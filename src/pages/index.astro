---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import TagButton from "../components/TagButton.astro";

const allArticles = await getCollection("articles");
const sortedArticles = allArticles
  .filter((article: CollectionEntry<"articles">) => !article.data.draft && !article.data.unlisted)
  .sort(
    (a: CollectionEntry<"articles">, b: CollectionEntry<"articles">) =>
      b.data.date.valueOf() - a.data.date.valueOf(),
  );
---

<BaseLayout title="Home">
  <!-- Keep the short site lead, then show articles listing (no "Articles" title) -->
  <div class="text-center py-14 max-w-3xl mx-auto">
    <h2 class="text-3xl font-semibold mb-3">Welcome to my personal website!</h2>
    <p class="text-gray-600 dark:text-gray-400">
      Articles on code, craft, and the products of my curiosity.
    </p>
  </div>

  <div
    id="articles-container"
    class="not-prose space-y-8 max-w-4xl mx-auto px-4"
  >
    {
      sortedArticles.length === 0 ? (
        <div class="p-4 text-center text-gray-500 dark:text-gray-400">
          No articles found
        </div>
      ) : (
        sortedArticles.map((article) => (
          <article
            class="article-post border-b border-gray-200 dark:border-gray-800 pb-8"
            data-title={article.data.title.toLowerCase()}
            data-description={article.data.description.toLowerCase()}
            data-tags={
              article.data.tags ? article.data.tags.join(",").toLowerCase() : ""
            }
          >
            <a
              href={`/articles/${article.slug}`}
              class="group !text-gray-900 dark:!text-gray-100 no-underline hover:underline !hover:text-gray-700 dark:!hover:text-gray-300 transition-colors"
            >
              <h2 class="text-2xl font-bold mb-2">{article.data.title}</h2>
            </a>
            <p class="text-gray-600 dark:text-gray-400 mb-2">
              {article.data.description}
            </p>
            <div class="flex flex-wrap items-center gap-x-4 gap-y-0 text-sm text-gray-500 dark:text-gray-500">
              <time datetime={article.data.date.toISOString()}>
                {new Date(article.data.date).toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })}
              </time>
              <span class="text-sm">•</span>
              <a href="/about" class="text-sm font-medium hover:underline">
                Keenan Thompson
              </a>
              {article.data.tags && article.data.tags.length > 0 ? (
                <>
                  <span class="text-sm">•</span>
                  <div class="flex gap-2 flex-wrap">
                    {article.data.tags.map((tag: string) => (
                      <TagButton tag={tag} />
                    ))}
                  </div>
                </>
              ) : null}
            </div>
          </article>
        ))
      )
    }
  </div>
</BaseLayout>
